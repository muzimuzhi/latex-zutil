\input{zutil-regression-test}
\documentclass{minimal}

\usepackage[presets=none]{zutil}

\ExplSyntaxOn

\zutil_load_module:n { l3extras }

\debug_on:n { check-declarations , deprecation }

\START

\BEGINTEST{\zutil_msg_space_safe_on:/off:}
  \debug_on:n { log-functions }
  \zutil_msg_space_safe_on:
  \msg_new:nnnn { test } { msg-long }
    { Text. } { More text. }
  \msg_new:nnnn { test } { msg-long-with-args }
    { Text [#1] [#2] [#3] [#4]. } { More text [#1] [#2] [#3] [#4]. }
  \msg_new:nnn { test } { msg } { Text. }
  \msg_new:nnn { test } { msg-with-args }
    { Text [#1] [#2] [#3] [#4]. }
  \zutil_msg_space_safe_off:
  \int_compare:nNnTF
    { \char_value_catcode:n { 32 } } = { 9 } % 9 is the catcode for ignore
    { \PASSED }
    { \FAILED }

  \msg_error:nn { test } { msg-long }
  \msg_error:nnnnnn { test } { msg-long-with-args }
    { A } { B } { C } { \ERROR }
  \msg_warning:nn { test } { msg }
  \msg_warning:nnnnnn { test } { msg-with-args }
    { A } { B } { C } { \ERROR }

  \zutil_msg_space_safe_on:
  \msg_set:nnnn { test } { msg-long }
    { Changed. } { Even more text. }
  \msg_set:nnnn { test } { msg-long-with-args }
    { Changed [#1] [#2] [#3] [#4]. } { Even more text [#1] [#2] [#3] [#4]. }
  \msg_set:nnn { test } { msg } { Changed. }
  \msg_set:nnn { test } { msg-with-args }
    { Changed [#1] [#2] [#3] [#4]. }
  \zutil_msg_space_safe_off:
  \int_compare:nNnTF
    { \char_value_catcode:n { 32 } } = { 9 } % 9 is the catcode for ignore
    { \PASSED }
    { \FAILED }

  \msg_error:nn { test } { msg-long }
  \msg_error:nnnnnn { test } { msg-long-with-args }
    { \ERROR } { B } { C } { D }
  \msg_warning:nn { test } { msg }
  \msg_warning:nnnnnn { test } { msg-with-args }
    { \ERROR } { B } { C } { D }
\ENDTEST

\END
