\input{zutil-regression-test}
\documentclass{minimal}

% \usepackage[presets=none]{zutil}

\ExplSyntaxOn

\debug_on:n { check-declarations , deprecation }

% \msg_redirect_module:nnn { test } { error } { softerror }
\msg_new:nnn { test } { msg1 } { This~is~a~test~message. }

\START

\TEST{No~errors~nor~checks}{
}

\TEST{Count~expl3~errors}{
  \msg_error:nn { test } { msg1 }
}

\TEST{Count~expl3~expandable~errors}{
  \msg_expandable_error:nn { test } { msg1 }
}

\TEST{Count~latex2e~errors}{
  \PackageError{test}{error~text}{}
}

\TEST{Count~errors~raised~in~deeper~groups}{
  {
    \msg_error:nn { test } { msg1 }
    {
      \PackageError{test}{error~text}{}
    }
  }
}

\TEST{Not~counted:~expandable~errors~raised~in~deeper~groups}{
  {
    {
      \msg_expandable_error:nn { test } { msg1 }
    }
  }
}

\OMIT
\msg_expandable_error:nn { test } { msg1 }
\TIMO
\TEST{Count~expandable~errors~between~tests}{
  \TYPE { BODY }
}

\TEST{Count~checks}{
  \PASSED
}

% \PASSED is only defined in tests
\cs_if_exist:NF \PASSED { \TYPE { PASSED } }

\TEST{Not~counted:~checks~used~in~deeper~groups}{
  {
    \PASSED
  }
}

{
  \TEST{Errors~and~checks~in~a~deeper-group~test}{
    \msg_error:nn { test } { msg1 }
    \msg_expandable_error:nn { test } { msg1 }
    \PackageError{test}{error~text}{}
    \PASSED
  }
}

\TEST{Check~group~level~at~end~of~test}{
  \test_type:e { GROUP-LEVEL:~\the\currentgrouplevel }
  \group_begin:
  \test_type:e { GROUP-LEVEL:~\the\currentgrouplevel }
}
\group_end:

\END
