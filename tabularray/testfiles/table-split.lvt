\input{regression-test}
\documentclass{article}

\ExplSyntaxOn
\debug_on:n { check-declarations , check-expressions , deprecation }
\ExplSyntaxOff

\usepackage{tabularray}

\begin{document}

\SetTblrTracing{+text}

\START

% https://github.com/lvjr/tabularray/issues/501
\BEGINTEST{keep braces when splitting table into cells}
\begin{tblr}{l}
  a \\
  {b} \\
  {{c}} \\
  {{{d}}} \\
  {{{{e}}}}
\end{tblr}

\begin{tblr}{l}
  1 & a \\
  2 & {b} \\
  3 & {{c}} \\
  4 & {{{d}}}
\end{tblr}
\ENDTEST

% https://github.com/muzimuzhi/tabularray-dev/issues/4
\BEGINTEST{keep braces when extracting table commands}
% leading braced cell text should be saved as-is
\begin{tblr}{l}
  a & {a} & {a}a & {a} a \\
\end{tblr}

% spaces between table commands or after the last table command should
% be trimmed
\begin{tblr}{l}
  \SetCell{} & \SetCell{} a & \SetCell{} {a} & a \SetCell{} \\
  \SetCell{} \SetCell{} a & \SetCell{} \SetCell{} {a}
\end{tblr}
\ENDTEST


\SetTblrTracing{+column = @col-width}

\BEGINTEST{multiline cells}
% for multiline cells, space trimming is done on a line-by-line basis
\begin{tblr}{vlines}
  % first three columns should have the same width
  % forth column should be wider than others
  p & { p \\ p } & { p \\ p \\ p } \\
  \SetCell{} p
    & \SetCell{} { p \\ p }
    & \SetCell{} { p \\ p \\ p }
    & \SetCell{} { \SetCell{} p \\ p \\ p }
\end{tblr}
\ENDTEST

\end{document}

\END
